<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Code Translator</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, sans-serif; margin: 24px; line-height: 1.35; }
    textarea { width: 100%; min-height: 140px; padding: 12px; font-size: 16px; }
    .row { display: flex; gap: 12px; margin: 12px 0; flex-wrap: wrap; }
    button, select { padding: 10px 12px; font-size: 15px; }
    .hint { opacity: 0.75; font-size: 13px; margin-top: 8px; }
  </style>
</head>
<body>
  <h1>Our Code Translator</h1>

  <label for="input">Input</label>
  <textarea id="input" placeholder="Type English (or coded text) here..."></textarea>

  <div class="row">
    <button id="encode">Encode →</button>
    <button id="decode">← Decode</button>

    <label>
      Suffix:
      <select id="suffix">
        <option value="a" selected>a</option>
        <option value="o">o</option>
      </select>
    </label>

    <label>
      Preserve capitalization:
      <select id="caps">
        <option value="yes" selected>Yes</option>
        <option value="no">No</option>
      </select>
    </label>
  </div>

  <label for="output">Output</label>
  <textarea id="output" readonly></textarea>

  <div class="hint">
    Rule: move first letter to end + add suffix (encode). Remove suffix + move last letter to front (decode).
    Punctuation and spacing are preserved.
  </div>

<script>
  const inputEl = document.getElementById("input");
  const outputEl = document.getElementById("output");
  const suffixEl = document.getElementById("suffix");
  const capsEl = document.getElementById("caps");

  function isLetter(ch) {
    return /[A-Za-z]/.test(ch);
  }

  // Split into tokens while preserving spaces and punctuation:
  // - words: sequences containing letters/apostrophes
  // - everything else: single characters (punctuation, spaces, emojis, etc.)
  function tokenize(text) {
    const tokens = [];
    let i = 0;

    while (i < text.length) {
      const ch = text[i];

      // Word token: starts with a letter
      if (isLetter(ch)) {
        let j = i + 1;
        while (j < text.length) {
          const c = text[j];
          // Keep letters and internal apostrophes (don't, you're)
          if (isLetter(c) || c === "'") j++;
          else break;
        }
        tokens.push(text.slice(i, j));
        i = j;
      } else {
        // Non-word token: keep exact char (space/punct)
        tokens.push(ch);
        i++;
      }
    }
    return tokens;
  }

  function detectCapsStyle(word) {
    if (word.toUpperCase() === word) return "upper";
    if (word[0].toUpperCase() === word[0] && word.slice(1).toLowerCase() === word.slice(1)) return "title";
    return "lower";
  }

  function applyCapsStyle(word, style) {
    if (style === "upper") return word.toUpperCase();
    if (style === "title") return word[0].toUpperCase() + word.slice(1).toLowerCase();
    return word.toLowerCase();
  }

  function encodeWord(word, suffix, preserveCaps) {
    // Keep original caps style if requested
    const style = preserveCaps ? detectCapsStyle(word) : "lower";

    // Work in lowercase for transformation
    const w = word.toLowerCase();
    if (w.length === 0) return word;

    // If it's just "'" or weird edge, return as-is
    if (!/[a-z]/.test(w)) return word;

    // Move first letter to end, add suffix
    const first = w[0];
    const rest = w.slice(1);
    const coded = rest + first + suffix;

    return preserveCaps ? applyCapsStyle(coded, style) : coded;
  }

  function decodeWord(word, suffix, preserveCaps) {
    const style = preserveCaps ? detectCapsStyle(word) : "lower";
    const w = word.toLowerCase();

    // Only decode if it ends with the chosen suffix and has enough length
    if (!w.endsWith(suffix) || w.length < 2) return word;

    const core = w.slice(0, -1); // remove suffix
    const last = core[core.length - 1];
    const rest = core.slice(0, -1);
    const plain = last + rest;

    return preserveCaps ? applyCapsStyle(plain, style) : plain;
  }

  function transform(text, mode) {
    const suffix = suffixEl.value;
    const preserveCaps = capsEl.value === "yes";
    const tokens = tokenize(text);

    const out = tokens.map(tok => {
      // Only transform word tokens (they start with a letter)
      if (tok.length && isLetter(tok[0])) {
        return mode === "encode"
          ? encodeWord(tok, suffix, preserveCaps)
          : decodeWord(tok, suffix, preserveCaps);
      }
      return tok; // punctuation/space/etc.
    });

    return out.join("");
  }

  document.getElementById("encode").addEventListener("click", () => {
    outputEl.value = transform(inputEl.value, "encode");
  });

  document.getElementById("decode").addEventListener("click", () => {
    outputEl.value = transform(inputEl.value, "decode");
  });
</script>
</body>
</html>