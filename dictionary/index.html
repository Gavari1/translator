<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fliplish Translator</title>

  <style>
    :root {
      /* Night-light taupe */
      --bg: #d8cbb8;
      --panel: rgba(255,255,255,0.78);
      --border: rgba(17, 24, 39, 0.18);
      --text: #111827;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, sans-serif;
      margin: 24px;
      line-height: 1.35;
      background: var(--bg);
      color: var(--text);
    }

    textarea {
      width: 100%;
      min-height: 140px;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      outline: none;
    }

    textarea:focus {
      border-color: rgba(17, 24, 39, 0.35);
    }

    .row {
      display: flex;
      gap: 12px;
      margin: 12px 0;
      flex-wrap: wrap;
      align-items: center;
    }

    button, select {
      padding: 10px 12px;
      font-size: 15px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.65);
      color: var(--text);
      cursor: pointer;
    }

    button:active {
      transform: translateY(1px);
    }

    .hint {
      opacity: 0.75;
      font-size: 13px;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <h1>Fliplish Translator</h1>

  <label for="input">Input</label>
  <textarea id="input" placeholder="Type English (or coded text) here..."></textarea>

  <div class="row">
    <button id="encode">Encode →</button>
    <button id="decode">← Decode</button>
    <button id="clear">Clear</button>

    <label>
      Suffix:
      <select id="suffix">
        <option value="a" selected>a</option>
        <option value="o">o</option>
      </select>
    </label>

    <label>
      Preserve capitalization:
      <select id="caps">
        <option value="yes" selected>Yes</option>
        <option value="no">No</option>
      </select>
    </label>
  </div>

  <label for="output">Output</label>
  <textarea id="output" readonly></textarea>

  <div class="hint">
    Rule: move first letter to end + add suffix (encode).
    Remove suffix + move last letter to front (decode).
    Apostrophes inside words are preserved.
  </div>

<script>
  const inputEl = document.getElementById("input");
  const outputEl = document.getElementById("output");
  const suffixEl = document.getElementById("suffix");
  const capsEl = document.getElementById("caps");
  const clearBtn = document.getElementById("clear");

  // Tokenizer that keeps internal apostrophes together
  function tokenize(text) {
    return text.match(/[A-Za-z]+(?:['’][A-Za-z]+)*|[^A-Za-z]+/g) || [];
  }

  function detectCapsStyle(word) {
    if (word.toUpperCase() === word) return "upper";
    if (word[0].toUpperCase() === word[0] &&
        word.slice(1).toLowerCase() === word.slice(1)) return "title";
    return "lower";
  }

  function applyCapsStyle(word, style) {
    if (style === "upper") return word.toUpperCase();
    if (style === "title") return word[0].toUpperCase() + word.slice(1).toLowerCase();
    return word.toLowerCase();
  }

  function encodeWord(word, suffix, preserveCaps) {
    const style = preserveCaps ? detectCapsStyle(word) : "lower";
    const w = word.toLowerCase();
    if (w.length < 1) return word;
    const coded = w.slice(1) + w[0] + suffix;
    return preserveCaps ? applyCapsStyle(coded, style) : coded;
  }

  function decodeWord(word, suffix, preserveCaps) {
    const style = preserveCaps ? detectCapsStyle(word) : "lower";
    const w = word.toLowerCase();
    if (!w.endsWith(suffix) || w.length < 2) return word;
    const core = w.slice(0, -1);
    const plain = core.slice(-1) + core.slice(0, -1);
    return preserveCaps ? applyCapsStyle(plain, style) : plain;
  }

  function transform(text, mode) {
    const suffix = suffixEl.value;
    const preserveCaps = capsEl.value === "yes";
    return tokenize(text).map(tok => {
      if (/^[A-Za-z]/.test(tok)) {
        return mode === "encode"
          ? encodeWord(tok, suffix, preserveCaps)
          : decodeWord(tok, suffix, preserveCaps);
      }
      return tok;
    }).join("");
  }

  document.getElementById("encode").onclick = () =>
    outputEl.value = transform(inputEl.value, "encode");

  document.getElementById("decode").onclick = () =>
    outputEl.value = transform(inputEl.value, "decode");

  clearBtn.onclick = () => {
    inputEl.value = "";
    outputEl.value = "";
    inputEl.focus();
  };
</script>
</body>
</html>