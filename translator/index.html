<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gavári Dictionary</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b1020;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem 3rem;
    }

    h1 {
      margin-bottom: 0.25rem;
      text-align: center;
    }

    .subtitle {
      opacity: 0.8;
      margin-bottom: 1.5rem;
      font-size: 0.95rem;
      text-align: center;
    }

    .card {
      background: #151a2b;
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 920px;
      width: 100%;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
      border: 1px solid #272f47;
    }

    /* ---------- TABS ---------- */
    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .tab-btn {
      border-radius: 999px;
      padding: 0.45rem 0.8rem;
      border: 1px solid #272f47;
      background: #0f1423;
      color: #f5f5f5;
      cursor: pointer;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .tab-btn:hover {
      background: #222842;
    }

    .tab-btn.active {
      border-color: #3f82ff;
      box-shadow: 0 0 0 1px #3f82ff44;
      opacity: 1;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* ---------- CONTROLS ---------- */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      margin-bottom: 1rem;
    }

    .search-box {
      flex: 1 1 220px;
    }

    label {
      font-size: 0.85rem;
      opacity: 0.9;
      display: block;
      margin-bottom: 0.2rem;
    }

    input[type="text"], textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      border: 1px solid #272f47;
      background: #0f1423;
      color: #f5f5f5;
      font-size: 0.95rem;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: #3f82ff;
      box-shadow: 0 0 0 1px #3f82ff44;
    }

    .alpha-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      justify-content: flex-end;
      font-size: 0.8rem;
    }

    .alpha-btn {
      border-radius: 999px;
      padding: 0.2rem 0.5rem;
      border: 1px solid #272f47;
      background: #0f1423;
      color: #f5f5f5;
      cursor: pointer;
    }

    .alpha-btn:hover {
      background: #222842;
    }

    .alpha-btn.disabled {
      opacity: 0.35;
      cursor: default;
    }

    .dictionary {
      margin-top: 0.75rem;
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 0.25rem;
    }

    .letter-section {
      margin-bottom: 1.25rem;
    }

    .letter-heading {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
      border-bottom: 1px solid #272f47;
      padding-bottom: 0.2rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th, td {
      padding: 0.35rem 0.35rem;
      vertical-align: top;
    }

    th {
      text-align: left;
      font-size: 0.8rem;
      text-transform: uppercase;
      opacity: 0.7;
      border-bottom: 1px solid #272f47;
    }

    tr:nth-child(even) td {
      background: #111727;
    }

    .col-en { width: 40%; font-weight: 500; }
    .col-gv { width: 30%; color: #b8d1ff; }
    .col-notes { width: 30%; font-size: 0.8rem; opacity: 0.8; }

    .hint {
      margin-top: 0.9rem;
      font-size: 0.8rem;
      opacity: 0.75;
      line-height: 1.4;
    }

    /* ---------- PHRASEBOOK ---------- */
    .phrase-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      align-items: end;
      margin-top: 0.5rem;
    }

    .btn {
      border-radius: 10px;
      padding: 0.55rem 0.85rem;
      border: 1px solid #272f47;
      background: #0f1423;
      color: #f5f5f5;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .btn:hover { background: #222842; }

    .btn.primary {
      border-color: #3f82ff;
      box-shadow: 0 0 0 1px #3f82ff22;
    }

    .phrase-list {
      margin-top: 0.75rem;
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 0.25rem;
    }

    .phrase-card {
      border: 1px solid #272f47;
      background: #0f1423;
      border-radius: 12px;
      padding: 0.9rem;
      margin-bottom: 0.65rem;
    }

    .phrase-top {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 0.35rem;
    }

    .phrase-en {
      font-weight: 600;
    }
    .phrase-gv {
      color: #b8d1ff;
      font-weight: 600;
      white-space: pre-wrap;
    }
    .phrase-notes {
      opacity: 0.8;
      font-size: 0.85rem;
      margin-top: 0.35rem;
      white-space: pre-wrap;
    }

    .phrase-tools {
      display: flex;
      gap: 0.4rem;
    }

    .icon-btn {
      border-radius: 10px;
      padding: 0.35rem 0.6rem;
      border: 1px solid #272f47;
      background: #151a2b;
      color: #f5f5f5;
      cursor: pointer;
      font-size: 0.85rem;
      opacity: 0.9;
    }
    .icon-btn:hover { background: #222842; }

    @media (max-width: 700px) {
      .card { padding: 1.1rem; }
      .controls { flex-direction: column; align-items: stretch; }
      .alpha-bar { justify-content: center; }
      th.col-notes, td.col-notes { display: none; }
    }
  </style>
</head>
<body>
  <h1>Gavári Dictionary</h1>
  <div class="subtitle">English ➜ Gavári · Official Lexicon</div>

  <div class="card">

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="tab-dict">Dictionary</button>
      <button class="tab-btn" data-tab="tab-phrases">Phrases & Sentences</button>
    </div>

    <!-- DICTIONARY TAB -->
    <div id="tab-dict" class="tab-panel active">
      <div class="controls">
        <div class="search-box">
          <label for="searchInput">Search (English or Gavári)</label>
          <input
            id="searchInput"
            type="text"
            placeholder="Type to filter… e.g. 'water', 'veru', 'house'"
          />
        </div>
        <div class="alpha-bar" id="alphaBar"></div>
      </div>

      <div id="dictionary" class="dictionary"></div>

      <div class="hint">
        <strong>How to update this page:</strong><br />
        Scroll down in the code to the <code>dictionaryEntries</code> array and just
        keep adding objects like:
        <code>{ english: "house", gavari: "fale", notes: "also ‘home’" }</code>.<br />
        The page will automatically sort them A–Z and group them by first letter.
      </div>
    </div>

    <!-- PHRASES TAB -->
    <div id="tab-phrases" class="tab-panel">
      <div class="controls">
        <div class="search-box">
          <label for="phraseSearch">Search (English or Gavári)</label>
          <input id="phraseSearch" type="text" placeholder="Type to filter… e.g. 'wait', 'pa', 'gavo-mōro'" />
        </div>
      </div>

      <div style="margin-top:0.5rem;">
        <label for="phraseEn">English</label>
        <input id="phraseEn" type="text" placeholder="e.g. I would run to my house" />

        <div style="height:0.6rem;"></div>

        <label for="phraseGv">Gavári</label>
        <input id="phraseGv" type="text" placeholder="e.g. Wa la’lelo olu sap fale-na olu" />

        <div style="height:0.6rem;"></div>

        <label for="phraseNotes">Notes (optional)</label>
        <textarea id="phraseNotes" placeholder="Any grammar notes, alternate gloss, vibe notes, etc."></textarea>

        <div class="phrase-actions">
          <button class="btn primary" id="addPhraseBtn">Add</button>
          <button class="btn" id="clearPhraseFormBtn">Clear</button>
          <button class="btn" id="resetPhrasesBtn" title="Clears saved phrases from this browser">Reset saved phrases</button>
        </div>

        <div class="hint" style="margin-top:0.8rem;">
          This tab saves phrases <strong>in your browser</strong> (localStorage). If you open the site on another device,
          you won’t see them unless you paste them into the <code>defaultPhrasebook</code> array below or export/import later.
        </div>
      </div>

      <div id="phraseList" class="phrase-list"></div>
    </div>

  </div>

  <script>
    // ---------------------------------------------
    // 1) DICTIONARY WORD LIST
    // ---------------------------------------------
    const dictionaryEntries = [
      { english: "above", gavari: "alun" },
      { english: "after", gavari: "yalu" },
      { english: "afternoon", gavari: "daru" },
      { english: "again", gavari: "galua" },
      { english: "a little", gavari: "poa" },
      { english: "a lot", gavari: "muia" },
      { english: "air (warm night air)", gavari: "torai" },
      { english: "always", gavari: "saru" },
      { english: "also", gavari: "tambu" },
      // ... keep your full list here ...
    ];

    // ---------------------------------------------
    // 2) PHRASEBOOK DEFAULTS (optional)
    //    - These ship with the page.
    //    - Your added phrases save in the browser.
    // ---------------------------------------------
    const defaultPhrasebook = [
      // Example:
      // { english: "I would run to my house", gavari: "Wa la’lelo olu sap fale-na olu", notes: "conditional + motion-to sap + possessive -na" },
    ];

    const PHRASE_STORAGE_KEY = "gavari_phrasebook_v1";

    // ---------------------------------------------
    // SHARED HELPERS
    // ---------------------------------------------
    function normalize(str) {
      return (str || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "");
    }

    // ---------------------------------------------
    // TABS
    // ---------------------------------------------
    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabPanels = document.querySelectorAll(".tab-panel");

    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        tabButtons.forEach(b => b.classList.remove("active"));
        tabPanels.forEach(p => p.classList.remove("active"));

        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
      });
    });

    // ---------------------------------------------
    // DICTIONARY RENDERING
    // ---------------------------------------------
    const dictionaryContainer = document.getElementById("dictionary");
    const searchInput = document.getElementById("searchInput");
    const alphaBar = document.getElementById("alphaBar");

    function buildGroupedDictionary(entries) {
      const groups = {};
      for (const entry of entries) {
        const firstChar = entry.english.trim().charAt(0).toUpperCase();
        const letter = /[A-Z]/.test(firstChar) ? firstChar : "#";
        if (!groups[letter]) groups[letter] = [];
        groups[letter].push(entry);
      }
      for (const letter in groups) {
        groups[letter].sort((a, b) =>
          a.english.toLowerCase().localeCompare(b.english.toLowerCase())
        );
      }
      return groups;
    }

    function renderDictionary(filter = "", jumpToLetter = null) {
      const normFilter = normalize(filter);

      const filtered = dictionaryEntries.filter((entry) => {
        if (!normFilter) return true;
        const en = normalize(entry.english);
        const gv = normalize(entry.gavari);
        const notes = normalize(entry.notes || "");
        return en.includes(normFilter) || gv.includes(normFilter) || notes.includes(normFilter);
      });

      const groups = buildGroupedDictionary(filtered);
      const letters = Object.keys(groups).sort();

      dictionaryContainer.innerHTML = "";

      if (filtered.length === 0) {
        dictionaryContainer.innerHTML =
          "<p style='opacity:0.7;font-size:0.9rem;'>No entries found for that search.</p>";
        return;
      }

      const fragment = document.createDocumentFragment();

      letters.forEach((letter) => {
        const section = document.createElement("section");
        section.className = "letter-section";
        section.id = `letter-${letter}`;

        const heading = document.createElement("div");
        heading.className = "letter-heading";
        heading.textContent = letter === "#" ? "#" : letter;
        section.appendChild(heading);

        const table = document.createElement("table");

        const thead = document.createElement("thead");
        thead.innerHTML = `
          <tr>
            <th class="col-en">English</th>
            <th class="col-gv">Gavári</th>
            <th class="col-notes">Notes</th>
          </tr>
        `;
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        groups[letter].forEach((entry) => {
          const tr = document.createElement("tr");
          const enTd = document.createElement("td");
          const gvTd = document.createElement("td");
          const notesTd = document.createElement("td");

          enTd.className = "col-en";
          gvTd.className = "col-gv";
          notesTd.className = "col-notes";

          enTd.textContent = entry.english;
          gvTd.textContent = entry.gavari;
          notesTd.textContent = entry.notes || "";

          tr.appendChild(enTd);
          tr.appendChild(gvTd);
          tr.appendChild(notesTd);
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        section.appendChild(table);
        fragment.appendChild(section);
      });

      dictionaryContainer.appendChild(fragment);

      if (jumpToLetter && document.getElementById(`letter-${jumpToLetter}`)) {
        document.getElementById(`letter-${jumpToLetter}`)
          .scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    function renderAlphaBar() {
      const lettersInUse = new Set(
        dictionaryEntries.map((e) => (e.english.trim().charAt(0).toUpperCase() || "#"))
      );

      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
      alphaBar.innerHTML = "";

      letters.forEach((letter) => {
        const btn = document.createElement("button");
        btn.textContent = letter;
        btn.className = "alpha-btn";

        if (!lettersInUse.has(letter)) {
          btn.classList.add("disabled");
        } else {
          btn.addEventListener("click", () => renderDictionary(searchInput.value, letter));
        }
        alphaBar.appendChild(btn);
      });
    }

    searchInput.addEventListener("input", () => renderDictionary(searchInput.value));

    // ---------------------------------------------
    // PHRASEBOOK LOGIC (localStorage-backed)
    // ---------------------------------------------
    const phraseSearch = document.getElementById("phraseSearch");
    const phraseEn = document.getElementById("phraseEn");
    const phraseGv = document.getElementById("phraseGv");
    const phraseNotes = document.getElementById("phraseNotes");
    const addPhraseBtn = document.getElementById("addPhraseBtn");
    const clearPhraseFormBtn = document.getElementById("clearPhraseFormBtn");
    const resetPhrasesBtn = document.getElementById("resetPhrasesBtn");
    const phraseList = document.getElementById("phraseList");

    function loadPhrasebook() {
      try {
        const raw = localStorage.getItem(PHRASE_STORAGE_KEY);
        if (!raw) return [...defaultPhrasebook];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [...defaultPhrasebook];
        return parsed;
      } catch {
        return [...defaultPhrasebook];
      }
    }

    function savePhrasebook(items) {
      localStorage.setItem(PHRASE_STORAGE_KEY, JSON.stringify(items));
    }

    let phrasebook = loadPhrasebook();

    function renderPhrasebook(filter = "") {
      const norm = normalize(filter);
      const filtered = phrasebook.filter(p => {
        if (!norm) return true;
        return (
          normalize(p.english).includes(norm) ||
          normalize(p.gavari).includes(norm) ||
          normalize(p.notes || "").includes(norm)
        );
      });

      phraseList.innerHTML = "";

      if (filtered.length === 0) {
        phraseList.innerHTML =
          "<p style='opacity:0.7;font-size:0.9rem;'>No phrases found for that search.</p>";
        return;
      }

      filtered.forEach((p, idx) => {
        const card = document.createElement("div");
        card.className = "phrase-card";

        const top = document.createElement("div");
        top.className = "phrase-top";

        const left = document.createElement("div");
        left.innerHTML = `
          <div class="phrase-en">${p.english}</div>
          <div class="phrase-gv">${p.gavari}</div>
          ${p.notes ? `<div class="phrase-notes">${p.notes}</div>` : ""}
        `;

        const tools = document.createElement("div");
        tools.className = "phrase-tools";

        const del = document.createElement("button");
        del.className = "icon-btn";
        del.textContent = "Delete";
        del.addEventListener("click", () => {
          // delete by identity (not just filtered index)
          const realIndex = phrasebook.findIndex(x =>
            x.english === p.english && x.gavari === p.gavari && (x.notes || "") === (p.notes || "")
          );
          if (realIndex >= 0) {
            phrasebook.splice(realIndex, 1);
            savePhrasebook(phrasebook);
            renderPhrasebook(phraseSearch.value);
          }
        });

        const copy = document.createElement("button");
        copy.className = "icon-btn";
        copy.textContent = "Copy";
        copy.addEventListener("click", async () => {
          const text = `${p.english}\n${p.gavari}${p.notes ? `\nNotes: ${p.notes}` : ""}`;
          try { await navigator.clipboard.writeText(text); } catch {}
        });

        tools.appendChild(copy);
        tools.appendChild(del);

        top.appendChild(left);
        top.appendChild(tools);

        card.appendChild(top);
        phraseList.appendChild(card);
      });
    }

    function clearPhraseForm() {
      phraseEn.value = "";
      phraseGv.value = "";
      phraseNotes.value = "";
      phraseEn.focus();
    }

    addPhraseBtn.addEventListener("click", () => {
      const en = phraseEn.value.trim();
      const gv = phraseGv.value.trim();
      const notes = phraseNotes.value.trim();

      if (!en || !gv) {
        alert("Please fill in both English and Gavári.");
        return;
      }

      phrasebook.unshift({ english: en, gavari: gv, notes: notes || "" });
      savePhrasebook(phrasebook);
      clearPhraseForm();
      renderPhrasebook(phraseSearch.value);
    });

    clearPhraseFormBtn.addEventListener("click", clearPhraseForm);

    resetPhrasesBtn.addEventListener("click", () => {
      const ok = confirm("Reset saved phrasebook on this browser? This cannot be undone.");
      if (!ok) return;
      localStorage.removeItem(PHRASE_STORAGE_KEY);
      phrasebook = loadPhrasebook();
      renderPhrasebook("");
    });

    phraseSearch.addEventListener("input", () => renderPhrasebook(phraseSearch.value));

    // Initial render
    renderAlphaBar();
    renderDictionary("");
    renderPhrasebook("");
  </script>
</body>
</html>